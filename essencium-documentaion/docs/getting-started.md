![image essencium](./img/logotype_400x100px.svg)

# Getting Started

Essencium is not a ready-to-use application, but is integrated into projects as a library. There are currently four ways
to integrate Essencium into an application:

- [Essencium Backend](https://central.sonatype.com/artifact/de.frachtwerk/essencium-backend): All Essencium
  functionalities are included in this core component. The use of this library still requires a few implementations
  within the application, but also offers the greatest flexibility.
- [Essencium Backend Identity Model Implementation](https://central.sonatype.com/artifact/de.frachtwerk/essencium-backend-identity-model):
  This library includes the core component and uses `GenerationType.IDENTITY` throughout the application.
- [Essencium Backend Sequence Model Implementation](https://central.sonatype.com/artifact/de.frachtwerk/essencium-backend-sequence-model):
  This library includes the core component and uses `GenerationType.SEQUENCE` throughout the application.
- [Essencium Backend UUID Model Implementation](https://central.sonatype.com/artifact/de.frachtwerk/essencium-backend-uuid-model):
  This library includes the core component and uses `GenerationType.UUID` throughout the application. This means that
  the primary key is generated by the application and not by the database.

> This guide assumes that you are using Maven as your project management tool. If you are using Gradle or another tool,
> the specific steps for adding and updating dependencies may be different.

## Requirements

- Java 17
- Maven >= 3.8.x

## Just run it (Demo)

Essencium provides a ready-made demo application for development and demonstration purposes. It shows a few of the
features and can be used as an example for your own implementations.

### Run via IDE / CLI

1. Clone the repository: `git clone https://github.com/Frachtwerk/essencium-backend.git`
2. Navigate to the project directory: `cd essencium-backend`
3. Install the core component:
    - Navigate to the core component directory: `cd essencium-backend`
    - Install the core component: `mvn clean install` (you can skip tests by
      adding `-Dskip.unit.tests -Dskip.integration.tests`)
    - Don't forget to switch back to the project directory: `cd ..`
4. Install the Model Implementation used in the demo application:
    - Navigate to the model implementation directory: `cd essencium-backend-sequence-model`
    - Install the model implementation: `mvn clean install`
    - Don't forget to switch back to the project directory: `cd ..`
5. Run the demo application:
    - Navigate to the demo application directory: `cd essencium-backend-development`
    - Run the demo application: `mvn spring-boot:run`

The API is now available at `http://localhost:8098`. See
the [API documentation](http://localhost:8098/swagger-ui/index.html) for more information.

### Run via Docker

> For the Docker setup, you need to have Docker and Docker Compose installed on your machine.

1. Clone the repository: `git clone https://github.com/Frachtwerk/essencium-backend.git`
2. Navigate to the docker directory: `cd docker`
3. Run the docker-compose file: `docker-compose up`, respectively `docker-compose up -d` for detached mode

The API is now available at `http://localhost:8098`. See
the [API documentation](http://localhost:8098/swagger-ui/index.html) for more information.

## Create a new project

To create a new project with Essencium, you need to add the core component and the model implementation to your project.
You can do this by adding the following dependencies to your `pom.xml` file:

```xml

<project>
    <!-- ... -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.3.0</version>
    </parent>

    <dependencies>
        <!-- ... -->
        <dependency>
            <groupId>de.frachtwerk</groupId>
            <artifactId>essencium-backend</artifactId>
            <version>2.5.14</version>
        </dependency>
        <dependency>
            <groupId>de.frachtwerk</groupId>
            <artifactId>essencium-backend-identity-model
            </artifactId> <!-- or essencium-backend-sequence-model or essencium-backend-uuid-model -->
            <version>2.5.14</version>
        </dependency>
        <!-- ... -->
    </dependencies>
    <!-- ... -->
</project>
```

Additionally, you need to specify which database you want to use. You can do this by adding the following dependency to
your `pom.xml` file:

```xml

<project>
    <!-- ... -->
    <dependencies>
        <!-- ... -->
        <!-- For using H2 as database backend. Recommended for development only. -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <version>2.2.224</version>
            <scope>runtime</scope>
        </dependency>
        <!-- For using PostgreSQL as database backend. -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <version>42.7.3</version>
            <scope>runtime</scope>
        </dependency>
        <!-- ... -->
    </dependencies>
    <!-- ... -->
</project>
```

For Maven support, you need to add the following plugin to your `pom.xml` file:

```xml

<project>
    <!-- ... -->
    <build>
        <plugins>
            <!-- ... -->
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <layers>
                        <enabled>true</enabled> <!-- Enable layering, recommended for docker deployments -->
                    </layers>
                </configuration>
            </plugin>
            <!-- ... -->
        </plugins>
    </build>
    <!-- ... -->
</project>
```

For a basic configuration, you can use the following `application.yml` file:

```yaml
server:
  port: 8098

spring:
  application:
    name: My Application
  jpa:
    generate-ddl: true
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        globally_quoted_identifiers: true
      database-platform: org.hibernate.dialect.H2Dialect # For H2
      # database-platform: org.hibernate.dialect.PostgreSQLDialect # For PostgreSQL
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: password
    # url: jdbc:postgresql://localhost:5432/essencium
    # driver-class-name: org.postgresql.Driver
    # username: essencium
    # password: essencium

mail:
  host: localhost
  port: 587
  username: dev@frachtwerk.de
  password: changeme

  default-sender:
    name: Essencium Mailer
    address: dev@frachtwerk.de

  smtp:
    auth: true
    start-tls: true

  branding:
    logo: https://static.frachtwerk.de/frachtwerk_320px.png
    name: ${spring.application.name}
    url: ${app.url}
    primary-color: "#00b5d6"
    text-color: "#ffffff"

  new-user-mail:
    subject-key: mail.new-user.subject
    template: NewUserMessage.ftl
    reset-link: setPassword?token=

  reset-token-mail:
    subject-key: mail.reset-token.subject
    template: ResetTokenMessage.ftl
    reset-link: setPassword?token=

  contact-mail:
    subject-prefix-key: mail.contact.subject.prefix
    recipients:
      - dev@frachtwerk.de
    template: ContactMessage.ftl
    locale: de

  new-login-mail:
    subject-key: mail.new-login.subject
    template: NewLoginMessage.ftl

app:
  domain: localhost
  url: http://${app.domain}:8098
  auth:
    jwt:
      access-token-expiration: 86400 # 24 hours
      refresh-token-expiration: 2592000 # 30 days
      issuer: Frachtwerk GmbH
      cleanup-interval: 3600 # 1 hour
      max-session-expiration-time: 86400 # 24 hours

pom:
  version: '@project.version@'

essencium:
  init:
    roles:
      - name: ADMIN
        description: Administrator
        rights: [ ]
        protected: true
    users:
      - first-name: Admin
        last-name: User
        username: devnull@frachtwerk.de
        password: adminAdminAdmin
        roles:
          - ADMIN
  jpa:
    table-prefix: "FW_"
    camel-case-to-underscore: true
```

Furthermore your Main class should look like this:

```java
package com.example.demo;

// imports

@SpringBootApplication(
        scanBasePackages = {
                "com.example.demo",
                "de.frachtwerk.essencium.backend"
        })
@EntityScan(
        basePackages = {
                "com.example.demo",
                "de.frachtwerk.essencium.backend"
        })
@ConfigurationPropertiesScan(
        basePackages = {
                "com.example.demo",
                "de.frachtwerk.essencium.backend"
        })
@EnableJpaRepositories(
        basePackages = {
                "com.example.demo",
                "de.frachtwerk.essencium.backend"
        })
@OpenAPIDefinition(
        servers = {@Server(url = "${app.url:localhost:8098}")},
        info = @Info(title = "Application API", version = "1.0.0"))
public class SpringBootApp {
    public static void main(String[] args) {
        SpringApplication.run(SpringBootApp.class, args);
    }
}
```

Now you can start your application and access the API at `http://localhost:8098`. You can run the application via your IDE or via the command line with `mvn spring-boot:run`.

## Project Initializer (under development)

A project initializer is currently under development. This will allow you to create a new project with Essencium by running a simple command and answering a few questions. The project initializer will automatically add the necessary dependencies and configurations to your project. For more information check the [Essencium Backend Initializer](https://github.com/Frachtwerk/essencium-backend-initializer). Stay tuned for updates!
